<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Itinerary: NPS Trip Planner</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {margin: 0; padding: 0; box-sizing: border-box;}
        body {font-family: 'Inter', sans-serif; line-height: 1.6; color: #333; background: #f8f8f8; min-height: 100vh;}
        /* navs */
        .navbar {background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: fixed; top: 0; width: 100%;
            z-index: 1000; padding: 1rem 0;}
        .nav-container {max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between;
            align-items: center; padding: 0 2rem;}
        .logo {font-size: 1.8rem; font-weight: bold; color: #2F4F2F;}
        .nav-links {display: flex; list-style: none; gap: 2rem;}
        .nav-links a {text-decoration: none; color: #333; font-weight: 500; transition: color 0.3s ease;}
        .nav-links a:hover {color: #2F4F2F;}
        .nav-links a.active {color: #2F4F2F; border-bottom: 2px solid #2F4F2F;}

        /* main content */
        .main-content {padding: 100px 0 50px; max-width: 1000px; margin: 0 auto; padding-left: 2rem; padding-right: 2rem;}
        
        /* screens */
        .screen {display: none;}
        .screen.active {display: block;}
        
        /* header */
        .header {text-align: center; margin-bottom: 40px;}
        .header h1 {font-size: 2.5rem; color: #2F4F2F; margin-bottom: 1rem; font-weight: 700;}
        .header p {font-size: 1.2rem; color: #666; max-width: 600px; margin: 0 auto;}

        /* trip naming */
        .trip-form {background: white; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 30px;}
        .form-group {margin-bottom: 30px;}
        .form-group label {display: block; font-size: 1.1rem; font-weight: 600; color: #333; margin-bottom: 10px;}
        .form-group input {width: 100%; padding: 15px; border: 2px solid #ddd; font-size: 1.1rem; transition: border-color 0.3s ease;}
        .form-group input:focus {outline: none; border-color: #2F4F2F;}
        .cache-warning {background: #fff3cd; border: 2px solid #ffc107; padding: 15px; margin-bottom: 30px; color: #856404; font-weight: 500;}
        
        /* selected parks display */
        .selected-parks {background: white; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 30px;}
        .selected-parks h3 {font-size: 1.4rem; color: #2F4F2F; margin-bottom: 20px; font-weight: 600;}
        .parks-list {display: flex; flex-direction: column; gap: 15px;}
        .park-item {display: flex; align-items: center; gap: 15px; padding: 15px; background: #f9f9f9; border: 1px solid #ddd;}
        .park-icon {width: 50px; height: 50px; background: #2F4F2F; color: white; display: flex; align-items: center; 
            justify-content: center; font-weight: bold; font-size: 1.2rem;}
        .park-details h4 {color: #333; font-weight: 600; margin-bottom: 5px;}
        .park-details p {color: #666; font-size: 0.9rem;}
        .trip-dates {color: #8B4513; font-weight: 600; margin-left: auto;}

        /* day assignment section (for multi-park trips) */
        .day-assignment {background: white; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 30px;}
        .day-assignment h3 {font-size: 1.4rem; color: #2F4F2F; margin-bottom: 20px; font-weight: 600;}
        .day-picker {margin-bottom: 30px;}
        .day-picker h4 {color: #333; margin-bottom: 15px; font-weight: 600;}
        .days-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; margin-bottom: 20px;}
        .day-button {padding: 12px; background: white; border: 2px solid #ddd; cursor: pointer; text-align: center;
            font-weight: 600; transition: all 0.3s ease;}
        .day-button:hover {border-color: #2F4F2F; background: #f9f9f9;}
        .day-button.selected {background: #2F4F2F; color: white; border-color: #2F4F2F;}
        .day-button.assigned-other {background: #ccc; color: #666; border-color: #999; cursor: not-allowed;}
        .day-button.disabled {background: #f5f5f5; color: #999; cursor: not-allowed;}

        /* preferences display */
        .preferences-display {background: white; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 30px;}
        .preferences-display h3 {font-size: 1.4rem; color: #2F4F2F; margin-bottom: 20px; font-weight: 600;}
        .preferences-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;}
        .preference-group h4 {color: #333; margin-bottom: 10px; font-weight: 600;}
        .preference-tags {display: flex; flex-wrap: wrap; gap: 5px;}
        .preference-tag {background: #f0f0f0; padding: 4px 8px; font-size: 0.8rem; color: #333;}
        .preference-value {color: #666; font-weight: 500;}

        /* trip overview display */
        .trip-overview {background: white; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 30px;}
        .trip-title {font-size: 2rem; color: #2F4F2F; margin-bottom: 10px; font-weight: 700;}
        .trip-subtitle {color: #666; font-size: 1.1rem; margin-bottom: 30px;}
        
        .trip-timeline {margin: 30px 0;}
        .timeline-item {margin-bottom: 30px; padding: 25px; background: #f9f9f9; border: 2px solid #2F4F2F;}
        .timeline-header {display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;}
        .timeline-date {background: #2F4F2F; color: white; padding: 8px 15px; font-weight: 600;}
        .timeline-park {font-size: 1.3rem; font-weight: 600; color: #333;}
        .timeline-content {margin-bottom: 20px;}
        .timeline-content p {color: #666; margin-bottom: 10px;}
        .weather-preview {background: #8B4513; color: white; padding: 5px 10px; font-size: 0.8rem; display: inline-block;}

        /* accommodation + dining sections */
        .day-sections {display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;}
        .section {background: white; padding: 20px; border: 2px solid #ddd;}
        .section h5 {color: #333; margin-bottom: 10px; font-weight: 600; font-size: 1rem;}
        .section-placeholder {color: #999; font-style: italic; text-align: center; padding: 20px 0;}
        .meals-grid {display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;}
        .meal-slot {background: #f9f9f9; padding: 15px; text-align: center; border: 1px solid #eee;}
        .meal-slot h6 {color: #333; margin-bottom: 5px; font-size: 0.9rem; font-weight: 600;}
        .meal-placeholder {color: #999; font-size: 0.8rem; font-style: italic;}

        /* action buttons */
        .action-section {text-align: center; padding: 20px 0;}
        .button-row {display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap; margin-bottom: 15px;}
        .btn {background: #2F4F2F; color: white; border: none; padding: 15px 30px; font-size: 1.1rem;
            font-weight: bold; cursor: pointer; transition: all 0.3s ease;}
        .btn:hover {background: #1a3a1a; transform: translateY(-2px);}
        .btn:disabled {background: #ccc; cursor: not-allowed; transform: none;}
        .btn-secondary {background: #8B4513;}
        .btn-secondary:hover {background: #5d2d0a;}
        .btn-danger {background: #dc3545;}
        .btn-danger:hover {background: #c82333;}

        /* next steps section */
        .next-steps {background: white; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 30px; text-align: center;}
        .next-steps h3 {font-size: 1.6rem; color: #2F4F2F; margin-bottom: 20px; font-weight: 600;}
        .next-steps p {color: #666; margin-bottom: 20px; line-height: 1.6;}
        .disclaimer {background: #f8f9fa; padding: 20px; margin: 20px 0; border-left: 4px solid #2F4F2F; text-align: left;}
        .disclaimer strong {color: #2F4F2F;}

        /* responsive */
        @media (max-width: 768px) {
            .nav-container {padding: 0 1rem;}
            .nav-links {display: none;}
            .main-content {padding: 100px 1rem 50px;}
            .trip-form, .selected-parks, .trip-overview, .next-steps, .day-assignment, .preferences-display {padding: 25px;}
            .timeline-header {flex-direction: column; gap: 10px; align-items: flex-start;}
            .day-sections {grid-template-columns: 1fr;}
            .meals-grid {grid-template-columns: 1fr;}
            .button-row {flex-direction: column; gap: 10px;}
            .btn {width: 100%; max-width: 300px;}
            .preferences-grid {grid-template-columns: 1fr;}}
    </style>
</head>
<body>
    <!-- nav -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">US National Park Trip Planner</div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="#" class="active" id="myTripLink">My Current Trip</a></li>
                <li><a href="#">How It Works</a></li>
            </ul>
        </div>
    </nav>
    <div class="main-content">
        <!-- create trip -->
        <div class="screen active" id="createTripScreen">
            <div class="header">
                <h1>Create Your Trip</h1>
                <p>Give your adventure a name and review your selections</p>
            </div>
            <div class="cache-warning">
                <strong>Important:</strong> Your trip saves to browser only - be sure to export when done!
            </div>
            <div class="trip-form">
                <div class="form-group">
                    <label for="tripName">Trip Name (required):</label>
                    <input type="text" id="tripName" placeholder="e.g., Summer 2025 Western Parks Adventure" maxlength="100">
                </div>
            </div>
            <!-- display user prefs -->
            <div class="preferences-display" id="preferencesDisplay">
                <h3>Your Trip Preferences</h3>
                <div class="preferences-grid">
                    <div class="preference-group">
                        <h4>Activities</h4>
                        <div class="preference-tags" id="activitiesTags"></div>
                    </div>
                    <div class="preference-group">
                        <h4>Topics</h4>
                        <div class="preference-tags" id="topicsTags"></div>
                    </div>
                    <div class="preference-group">
                        <h4>Climate</h4>
                        <div class="preference-value" id="climateValue"></div>
                    </div>
                    <div class="preference-group">
                        <h4>Crowds</h4>
                        <div class="preference-value" id="crowdsValue"></div>
                    </div>
                </div>
            </div>
            <div class="selected-parks">
                <h3>Your Selected Parks</h3>
                <div class="parks-list" id="parksList">
                    <!-- parks loaded here -->
                </div>
            </div>
            <!-- day assignment for multi-park trips -->
            <div class="day-assignment" id="dayAssignment" style="display: none;">
                <h3>Assign Days to Each Park</h3>
                <div id="dayPickerContainer">
                    <!-- day pickers here -->
                </div>
            </div>
            <div class="action-section">
                <div class="button-row">
                    <button class="btn btn-secondary" onclick="goBack()">← Back to Park Selection</button>
                    <button class="btn" id="createTripBtn" onclick="createTrip()" disabled>Create Trip →</button>
                </div>
            </div>
        </div>
        <!-- trip overview -->
        <div class="screen" id="tripOverviewScreen">
            <div class="trip-overview">
                <div class="trip-title" id="overviewTripName">Your Trip Name</div>
                <div class="trip-subtitle" id="overviewTripDates">Trip dates and duration</div>
                <!-- display prefs in overview -->
                <div class="preferences-display">
                    <h3>Your Preferences</h3>
                    <div class="preferences-grid">
                        <div class="preference-group">
                            <h4>Activities</h4>
                            <div class="preference-tags" id="overviewActivities"></div>
                        </div>
                        <div class="preference-group">
                            <h4>Topics</h4>
                            <div class="preference-tags" id="overviewTopics"></div>
                        </div>
                        <div class="preference-group">
                            <h4>Climate</h4>
                            <div class="preference-value" id="overviewClimate"></div>
                        </div>
                        <div class="preference-group">
                            <h4>Crowds</h4>
                            <div class="preference-value" id="overviewCrowds"></div>
                        </div>
                    </div>
                </div>
                <div class="trip-timeline" id="tripTimeline">
                    <!-- better timeline here -->
                </div>
            </div>
            <div class="next-steps">
                <h3>Ready for the Next Step?</h3>
                <p>Your basic itinerary is complete! Next, you can find places to stay near your selected parks.</p>
                <div class="disclaimer">
                    <strong>Planning Disclaimer:</strong> This tool helps you organize your trip planning but cannot make actual reservations. 
                    You'll need to book accommodations, campsites, and make park reservations directly through official websites and services.
                </div>
                <div class="action-section">
                    <div class="button-row">
                        <button class="btn" onclick="continueToAccommodations()" disabled>Find Places to Stay (Coming Soon)</button>
                    </div>
                    <div class="button-row">
                        <button class="btn btn-secondary" onclick="goHome()">← Back to Home</button>
                        <button class="btn btn-secondary" onclick="editTrip()">Edit Parks & Details</button>
                        <button class="btn btn-danger" onclick="deleteTrip()">Delete Trip</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let PARKS_DATA = [];
        let parkSelectionData = {};
        let currentTrip = null;
        let dayAssignments = {}; //stores which days go to which park
        // load parks data
        async function loadParksData() {
            try {const recommendedParks = localStorage.getItem('nps_recommended_parks');
                if (recommendedParks) {
                    PARKS_DATA = JSON.parse(recommendedParks);
                    console.log('Parks data loaded from backend:', PARKS_DATA.length, 'parks');}
                else {
                    console.log('No recommended parks found, using empty array');
                    PARKS_DATA = [];}
            } catch (error) {
                console.error('Error loading parks data:', error);
                PARKS_DATA = [];}
        }

        // initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            await loadParksData();
            checkExistingTrip();});

        function checkExistingTrip() {
            const existingTrip = localStorage.getItem('nps_current_trip');
            
            if (existingTrip) {
                currentTrip = JSON.parse(existingTrip);
                console.log('Found existing trip:', currentTrip);
                if (PARKS_DATA.length === 0) {setTimeout(() => { showTripOverview(); }, 200);}
                else {showTripOverview();}}
            else {
                console.log('No existing trip found, showing create screen');
                loadSelectionData();
                displaySelectedParks();
                displayPreferences();
                setupDayAssignment();
                setupTripNameValidation();}
        }

        function loadSelectionData() {
            const stored = localStorage.getItem('nps_park_selection');
            if (stored) {
                parkSelectionData = JSON.parse(stored);
                console.log('Loaded park selection data:', parkSelectionData);}
            else {
                alert('No park selection found. Please start from the questionnaire.');
                window.location.href = 'questionnaire.html';
                return;}
        }

        function displayPreferences() {
            if (!parkSelectionData.questionnaire) return;
            const prefs = parkSelectionData.questionnaire;
            
            // activities
            const activitiesTags = document.getElementById('activitiesTags');
            if (prefs.activities && prefs.activities.length > 0) {
                activitiesTags.innerHTML = prefs.activities.map(activity => `<span class="preference-tag">${activity}</span>`).join('');}
            else {activitiesTags.innerHTML = '<span class="preference-value">None selected</span>';}
            
            // topics
            const topicsTags = document.getElementById('topicsTags');
            if (prefs.topics && prefs.topics.length > 0) {topicsTags.innerHTML = prefs.topics.map(topic => `<span class="preference-tag">${topic}</span>`).join('');}
            else {topicsTags.innerHTML = '<span class="preference-value">None selected</span>';}
            
            // climate and crowds
            document.getElementById('climateValue').textContent = prefs.climate || 'Not specified';
            document.getElementById('crowdsValue').textContent = prefs.crowds || 'Not specified';
        }

        function displaySelectedParks() {
            const parksList = document.getElementById('parksList');
            if (!parkSelectionData.parks || parkSelectionData.parks.length === 0) {
                parksList.innerHTML = '<p>No parks selected.</p>';
                return;}

            parksList.innerHTML = '';
            parkSelectionData.parks.forEach(parkCode => {// use parkCode instead of id!!
                const park = PARKS_DATA.find(p => p.parkCode === parkCode);
                if (!park) {
                    console.log('Park not found for code:', parkCode);
                    return;}

                const parkItem = document.createElement('div');
                parkItem.className = 'park-item';
                
                const startDate = new Date(parkSelectionData.questionnaire.startDate).toLocaleDateString();
                const endDate = new Date(parkSelectionData.questionnaire.endDate).toLocaleDateString();
                
                parkItem.innerHTML = `
                    <div class="park-icon">${park.fullName.charAt(0)}</div>
                    <div class="park-details">
                        <h4>${park.fullName}</h4>
                        <p>${park.description.substring(0, 80)}...</p>
                    </div>
                    <div class="trip-dates">${startDate} - ${endDate}</div>`;
                parksList.appendChild(parkItem);});
        }

        function setupDayAssignment() {
            if (!parkSelectionData.parks || parkSelectionData.parks.length < 2) {// single park trip: no day assignment needed!
                return;}
            
            // show day assignment section
            document.getElementById('dayAssignment').style.display = 'block';
            const startDate = new Date(parkSelectionData.questionnaire.startDate);
            const endDate = new Date(parkSelectionData.questionnaire.endDate);
            const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
            
            const container = document.getElementById('dayPickerContainer');
            container.innerHTML = '';
            
            // use parkCode instead of id!!
            const firstPark = PARKS_DATA.find(p => p.parkCode === parkSelectionData.parks[0]);
            const firstPicker = createDayPicker(firstPark, startDate, totalDays, 0);
            container.appendChild(firstPicker);
            const secondPark = PARKS_DATA.find(p => p.parkCode === parkSelectionData.parks[1]);
            const secondPicker = createDayPicker(secondPark, startDate, totalDays, 1);
            container.appendChild(secondPicker);
        }

        function createDayPicker(park, startDate, totalDays, parkIndex) {
            const picker = document.createElement('div');
            picker.className = 'day-picker';
            const daysArray = [];
            for (let i = 0; i < totalDays; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                daysArray.push(date);}
            
            picker.innerHTML = `
                <h4>Days at ${park.fullName}</h4>
                <div class="days-grid" id="daysGrid${parkIndex}">
                    ${daysArray.map((date, index) => 
                        `<div class="day-button" data-day="${index}" data-park="${parkIndex}" onclick="toggleDay(${index}, ${parkIndex})">
                            ${date.toLocaleDateString('en-US', {month: 'short', day: 'numeric'})}
                        </div>`).join('')}
                </div>`;
            return picker;
        }

        function toggleDay(dayIndex, parkIndex) {
            const button = document.querySelector(`[data-day="${dayIndex}"][data-park="${parkIndex}"]`);
            const otherParkIndex = parkIndex === 0 ? 1 : 0;
            const otherButton = document.querySelector(`[data-day="${dayIndex}"][data-park="${otherParkIndex}"]`);
            
            if (button.classList.contains('selected')) {
                // deselect this day - make it white
                button.classList.remove('selected');
                // other button becomes available (white) again
                otherButton.classList.remove('assigned-other');
                delete dayAssignments[dayIndex];}
            else {
                // select this day for this park
                button.classList.add('selected');
                // make other button gray (unavailable)
                otherButton.classList.add('assigned-other');
                otherButton.classList.remove('selected'); // ensure other isn't selected
                // assign this day to this park
                dayAssignments[dayIndex] = parkIndex;
            }
            updateCreateButton();
        }

        function updateCreateButton() {
            const createBtn = document.getElementById('createTripBtn');
            const tripName = document.getElementById('tripName').value.trim();
            let canCreate = tripName.length > 0;
            
            // if multi-park trip, need at least one day assigned to each park
            if (parkSelectionData.parks && parkSelectionData.parks.length > 1) {
                const park0Days = Object.values(dayAssignments).filter(p => p === 0).length;
                const park1Days = Object.values(dayAssignments).filter(p => p === 1).length;
                canCreate = canCreate && park0Days > 0 && park1Days > 0;
            }
            // single park trips don't need day assignments
            createBtn.disabled = !canCreate;
        }

        function setupTripNameValidation() {
            const tripNameInput = document.getElementById('tripName');
            tripNameInput.addEventListener('input', function() {updateCreateButton();});
        }

        function createTrip() {
            const tripName = document.getElementById('tripName').value.trim();
            if (!tripName) {
                alert('Please enter a trip name.');
                return;}

            // create trip object
            currentTrip = {
                id: 'trip_' + Date.now(),
                name: tripName,
                created: new Date().toISOString(),
                parks: parkSelectionData.parks,
                travelStyle: parkSelectionData.travelStyle,
                questionnaire: parkSelectionData.questionnaire,
                dayAssignments: dayAssignments, //store day assignments
                status: 'planning'};

            localStorage.setItem('nps_current_trip', JSON.stringify(currentTrip));
            console.log('Trip created and saved:', currentTrip);
            showTripOverview();
        }

        function showTripOverview() {
            document.getElementById('createTripScreen').classList.remove('active');
            document.getElementById('tripOverviewScreen').classList.add('active');
            
            if (PARKS_DATA.length === 0) {setTimeout(() => { populateTripOverview(); }, 100);}
            else {populateTripOverview();}
        }

        function populateTripOverview() {
            if (!currentTrip) {
                console.error('No current trip data');
                return;}

            console.log('Populating trip overview:', currentTrip);
            document.getElementById('overviewTripName').textContent = currentTrip.name;
            
            const startDate = new Date(currentTrip.questionnaire.startDate).toLocaleDateString();
            const endDate = new Date(currentTrip.questionnaire.endDate).toLocaleDateString();
            const duration = currentTrip.questionnaire.duration || 'Multiple days';
            
            document.getElementById('overviewTripDates').textContent = `${startDate} - ${endDate} • ${duration}`;

            // display prefs in overview
            const prefs = currentTrip.questionnaire;
            
            const overviewActivities = document.getElementById('overviewActivities');
            if (prefs.activities && prefs.activities.length > 0) {
                overviewActivities.innerHTML = prefs.activities.map(activity => `<span class="preference-tag">${activity}</span>`).join('');}
            else {overviewActivities.innerHTML = '<span class="preference-value">None selected</span>';}
            
            const overviewTopics = document.getElementById('overviewTopics');
            if (prefs.topics && prefs.topics.length > 0) {
                overviewTopics.innerHTML = prefs.topics.map(topic => `<span class="preference-tag">${topic}</span>`).join('');}
            else {overviewTopics.innerHTML = '<span class="preference-value">None selected</span>';}
            
            document.getElementById('overviewClimate').textContent = prefs.climate || 'Not specified';
            document.getElementById('overviewCrowds').textContent = prefs.crowds || 'Not specified';
            createEnhancedTimeline();
        }

        function createEnhancedTimeline() {
            const timeline = document.getElementById('tripTimeline');
            timeline.innerHTML = '';

            if (!currentTrip || !currentTrip.parks || currentTrip.parks.length === 0) {
                timeline.innerHTML = '<p>No parks selected for this trip.</p>';
                return;}

            const startDate = new Date(currentTrip.questionnaire.startDate);
            const endDate = new Date(currentTrip.questionnaire.endDate);
            const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
            const dayToPark = {};
            
            if (currentTrip.dayAssignments && Object.keys(currentTrip.dayAssignments).length > 0) {
                for (let day = 0; day < totalDays; day++) {dayToPark[day] = currentTrip.dayAssignments[day] || 0;}}
            else {
                const parksCount = currentTrip.parks.length;
                const daysPerPark = Math.floor(totalDays / parksCount);
                const extraDays = totalDays % parksCount;
                let currentDay = 0;
                currentTrip.parks.forEach((parkCode, parkIndex) => {
                    const parkDays = daysPerPark + (parkIndex < extraDays ? 1 : 0);
                    for (let i = 0; i < parkDays; i++) {
                        dayToPark[currentDay] = parkIndex;
                        currentDay++;}});
            }
            // group consecutive days by park
            const parkSegments = [];
            let currentSegment = null;
            
            for (let day = 0; day < totalDays; day++) {
                const parkIndex = dayToPark[day];
                const currentParkDate = new Date(startDate);
                currentParkDate.setDate(currentParkDate.getDate() + day);
                
                if (!currentSegment || currentSegment.parkIndex !== parkIndex) {
                    if (currentSegment) {parkSegments.push(currentSegment);}
                    currentSegment = {
                        parkIndex: parkIndex,
                        startDay: day,
                        endDay: day,
                        startDate: new Date(currentParkDate),
                        endDate: new Date(currentParkDate),
                        days: [day]};}
                else {
                    currentSegment.endDay = day;
                    currentSegment.endDate = new Date(currentParkDate);
                    currentSegment.days.push(day);}
            }
            if (currentSegment) {parkSegments.push(currentSegment);}

            // create timeline items for each segment
            parkSegments.forEach(segment => {
                // use parkCode instead of id!!
                const park = PARKS_DATA.find(p => p.parkCode === currentTrip.parks[segment.parkIndex]);
                if (!park) return;

                const timelineItem = document.createElement('div');
                timelineItem.className = 'timeline-item';
                
                // calc real weather data using 52 week ordering
                const weekIndex = getWeekOfYear(segment.startDate);
                const temperature = park.weather && park.weather.temperature ? 
                    Math.round(park.weather.temperature[weekIndex] || 70) : 70;
                const dateRange = segment.startDate.toLocaleDateString('en-US', {month: 'short', day: 'numeric'}) + 
                    (segment.days.length > 1 ? ' - ' + segment.endDate.toLocaleDateString('en-US', {month: 'short', day: 'numeric'}) : '');
                
                timelineItem.innerHTML = `
                    <div class="timeline-header">
                        <div class="timeline-park">${park.fullName}</div>
                        <div class="timeline-date">${dateRange} (${segment.days.length} day${segment.days.length > 1 ? 's' : ''})</div>
                    </div>
                    <div class="timeline-content">
                        <p>${park.description}</p>
                        <div class="weather-preview">Expected: ${temperature}°F</div>
                    </div>
                    <div class="day-sections">
                        <div class="section">
                            <h5>Accommodation</h5>
                            <div class="section-placeholder">Add places to stay (coming soon)</div>
                        </div>
                        <div class="section">
                            <h5>Dining</h5>
                            <div class="meals-grid">
                                ${segment.days.map(day => {
                                    const dayDate = new Date(startDate);
                                    dayDate.setDate(dayDate.getDate() + day);
                                    return `
                                        <div class="meal-slot">
                                            <h6>${dayDate.toLocaleDateString('en-US', {month: 'short', day: 'numeric'})}</h6>
                                            <div class="meal-placeholder">Breakfast</div>
                                            <div class="meal-placeholder">Lunch</div>
                                            <div class="meal-placeholder">Dinner</div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>`;
                timeline.appendChild(timelineItem);});
            console.log('Enhanced timeline created with', parkSegments.length, 'segments');
        }

        function getSeason(date) {
            const month = date.getMonth();
            if (month >= 2 && month <= 4) return 'spring';
            if (month >= 5 && month <= 7) return 'summer';
            if (month >= 8 && month <= 10) return 'fall';
            return 'winter';
        }

        function goBack() {
            window.location.href = 'park-selection.html';
        }

        function continueToAccommodations() {
            alert('Accommodation finder coming soon! This will help you find hotels and campsites near your parks.');
        }

        function goHome() {
            window.location.href = 'index.html';
        }

        function editTrip() {
            if (confirm('Do you want to modify your park selections and preferences? This will take you back to the park selection page.')) {
                localStorage.setItem('nps_questionnaire_data', JSON.stringify(currentTrip.questionnaire));
                localStorage.setItem('nps_park_selection', JSON.stringify({
                    parks: currentTrip.parks,
                    travelStyle: currentTrip.travelStyle,
                    questionnaire: currentTrip.questionnaire}));
                localStorage.removeItem('nps_current_trip');
                window.location.href = 'park-selection.html';}
            else {
                document.getElementById('tripOverviewScreen').classList.remove('active');
                document.getElementById('createTripScreen').classList.add('active');
                if (currentTrip) {
                    document.getElementById('tripName').value = currentTrip.name;
                    setupTripNameValidation();
                    updateCreateButton();
                    
                    parkSelectionData = {
                        parks: currentTrip.parks,
                        travelStyle: currentTrip.travelStyle,
                        questionnaire: currentTrip.questionnaire};
                    displaySelectedParks();
                    displayPreferences();
                    setupDayAssignment();
                    
                    //restore day assignments (if they exist!)
                    if (currentTrip.dayAssignments) {
                        dayAssignments = currentTrip.dayAssignments;
                        // update ui to show existing assignments
                        setTimeout(() => {
                            Object.keys(dayAssignments).forEach(day => {
                                const parkIndex = dayAssignments[day];
                                const button = document.querySelector(`[data-day="${day}"][data-park="${parkIndex}"]`);
                                const otherParkIndex = parkIndex === 0 ? 1 : 0;
                                const otherButton = document.querySelector(`[data-day="${day}"][data-park="${otherParkIndex}"]`);
                                if (button) button.classList.add('selected');
                                if (otherButton) otherButton.classList.add('assigned-other');});}, 100);
                    }
                }
            }
        }

        function deleteTrip() {
            if (confirm('Are you sure you want to delete your current trip? This cannot be undone.')) {
                localStorage.removeItem('nps_current_trip');
                localStorage.removeItem('nps_questionnaire_data');
                localStorage.removeItem('nps_park_selection');
                alert('Trip deleted successfully! Redirecting to homepage...');
                window.location.href = 'index.html';}
        }
    </script>
</body>
</html>